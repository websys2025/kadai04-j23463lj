<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <title>演習課題4：自動販売機（クラス）</title>
    </head>
    <body>
        <h1 id="vending-machine">自動販売機システム</h1>
        <table id="item_area" border="1"></table>
        <script>
            // 商品用のクラス定義
            class Item {
                static number = 1;
                constructor(name, price, stock) {
                    this.id = Item.number;
                    this.name = name;
                    this.price = price;
                    this.stock = stock;
                    Item.number++;
                }

                // 商品一覧の表示関数
                static showItemList(itemList) {
                    console.log("商品は以下の" + Item.number + "種類です。");

                    // 配列の内容を項目毎に出力
                    itemList.forEach(i => console.log(`id: ${i.id}, name: ${i.name}, ${i.price}円, 残り${i.stock}個`));
                    console.log(""); // 空行の出力
                }
                
                // 商品購入の関数
                buyItem() {          
                    // 不足の場合
                    if (this.stock < 1) {
                        console.log(this.name+"は商品の在庫がないため購入できません。");
                        return;
                    }
                     
                    console.log("商品番号: "+this.id+", 商品名: "+this.name+"を購入します。");
                    // 購入による商品の在庫削減処理
                    this.stock = this.stock - 1;
                    console.log("残りは"+this.stock+"個です。");

                    // 在庫用のエレメントを抽出し、HTML内の個数を更新
                    const rows = document.querySelectorAll('#item_area tbody tr');
                    rows.forEach(row => {
                        if (row.cells[0].textContent == this.name) {
                            row.cells[2].textContent = String(this.stock);
                            return;
                        }
                    });
                }
            }
            //=============================================class===================================================

            // 商品一覧を記録する連想配列の配列
            const items =  [
                new Item("緑茶", 140, 5),
                new Item("水", 100, 14),
                new Item("オレンジジュース", 150, 7),
                new Item("リンゴジュース", 150, 9),
                new Item("炭酸水", 120, 1),
                new Item("サイダー", 160, 3),
                new Item("コーヒー", 170, 8),
                new Item("紅茶", 140, 6),
            ]

            // 商品オブジェクトの生成
            Item.showItemList(items);

             // 商品テーブルのエレメント抽出
            const itemArea = document.getElementById("item_area");
            itemArea.innerHTML += "<thead><tr><th>商品名</th><th>金額</th><th>在庫数</th><th>購入</th></tr></thead>";
            // 商品表の作成
            for (const item of items) {
                itemArea.innerHTML += `<tr><th>${item.name}</th><th>${item.price}</th><th>${item.stock}</th><th>
                    <button id='btn_${item.id}'>購入</button></th></tr>`;
            }

            items.forEach(i => {
                document.getElementById("btn_" + i.id).onclick = function () {
                    i.buyItem();
                }
            });
        </script>
    </body>
</html>
<!-- 
期待される出力例
-----------------
id: 1, name: 緑茶, 140円, 残り5個
id: 2, name: 水, 100円, 残り14個
id: 3, name: オレンジジュース, 150円, 残り7個
id: 4, name: リンゴジュース, 150円, 残り9個
id: 5, name: 炭酸水, 120円, 残り1個
id: 6, name: サイダー, 160円, 残り3個
id: 7, name: コーヒー, 170円, 残り8個
id: 8, name: 紅茶, 140円, 残り6個
商品は以下の9種類です。
商品番号: 1, 商品名: 緑茶, 金額: 140, 在庫数: 5
商品番号: 2, 商品名: 水, 金額: 100, 在庫数: 14
商品番号: 3, 商品名: オレンジジュース, 金額: 150, 在庫数: 7
商品番号: 4, 商品名: リンゴジュース, 金額: 150, 在庫数: 9
商品番号: 5, 商品名: 炭酸水, 金額: 120, 在庫数: 1
商品番号: 6, 商品名: サイダー, 金額: 160, 在庫数: 3
商品番号: 7, 商品名: コーヒー, 金額: 170, 在庫数: 8
商品番号: 8, 商品名: 紅茶, 金額: 140, 在庫数: 6

商品番号: 2, 商品名: 水を購入します。
残りは13個です。
商品番号: 2, 商品名: 水を購入します。
残りは12個です。
商品番号: 4, 商品名: リンゴジュースを購入します。
残りは8個です。
商品番号: 5, 商品名: 炭酸水を購入します。
残りは0個です。
炭酸水は商品の在庫がないため購入できません。
-->
